<!doctype html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/lib/ember-table.css">
    <link rel="stylesheet" type="text/css" href="http://fast.fonts.net/cssapi/cc61a2f8-3c32-45ef-9be7-fc0cc1fab22b.css"/>
    <script src="/bower_components/jquery/dist/jquery.js"></script>
    <script src="/bower_components/jquery-ui/ui/jquery-ui.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.6/jquery.mousewheel.min.js"></script>
    <script type="text/javascript" src="/lib/antiscroll.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.3.0/handlebars.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/ember.js/1.5.0/ember.js"></script>
    <script type="text/javascript" src="/lib/ember-table.js"></script>
</head>
<body>
<script type="text/x-handlebars">
    <div style="padding:20px;width:1000px;margin:0 auto;">

        <div style="width:55%;margin: 0 auto;">
            <label for="startDate">Start Date</label>
            {{input id="startDate" type="date" class="formControl" value=startDate}}
            <label for="endDate">End Date</label>
            {{input id="endDate" type="date" class="formControl" value=endDate}}
        </div>
        <br>

        {{table-component
            hasFooter=false
            columnsBinding="columns"
            contentBinding="content"
        }}
    </div>
</script>
<script type="text/javascript" >
    function doAC(_content) {
        'use strict';
        const COLUMN_WIDTH = 160;

        window.DividendDawg = Ember.Application.create();

        DividendDawg.ApplicationController = Ember.Controller.extend({
            startDate: (new Date()).toISOString().substr(0, 10),
            endDate: (new Date()).toISOString().substr(0, 10),

            numRows: 100,

            columns: Ember.computed(function () {
                var tickerColumn = Ember.Table.ColumnDefinition.create({
                    columnWidth: COLUMN_WIDTH,
                    textAlign: 'text-align-left',
                    headerCellName: 'Ticker',
                    getCellContent: function (row) {
                        return row.tickerText;
                    }
                });

                var nameColumn = Ember.Table.ColumnDefinition.create({
                    columnWidth: COLUMN_WIDTH,
                    headerCellName: 'Company Name',
                    getCellContent: function (row) {
                        return row.companyName;
                    }
                });

                var exDateColumn = Ember.Table.ColumnDefinition.create({
                    columnWidth: COLUMN_WIDTH,
                    headerCellName: 'Ex Date',
                    getCellContent: function (row) {
                        return row.exDate;
                    }
                });

                var payDateColumn = Ember.Table.ColumnDefinition.create({
                    columnWidth: COLUMN_WIDTH,
                    headerCellName: 'Pay Date',
                    getCellContent: function (row) {
                        return row.payDate;
                    }
                });

                var payoutColumn = Ember.Table.ColumnDefinition.create({
                    columnWidth: COLUMN_WIDTH,
                    headerCellName: 'Payout',
                    getCellContent: function (row) {
                        return row.payout;
                    }
                });

                var yieldColumn = Ember.Table.ColumnDefinition.create({
                    columnWidth: COLUMN_WIDTH,
                    headerCellName: 'Yield',
                    getCellContent: function (row) {
                        return row.dividendYield;
                    }
                });

                return [tickerColumn, nameColumn, exDateColumn, payDateColumn, payoutColumn, yieldColumn];
            }),

            content: _content
        });
    }

    Ember.$.getJSON('/getDividendTable', function (json) {
        doAC(json.yield_rows);
    }).fail(function(){
        alert('HTTP REQUEST FAILED.');
    });
</script>
</body>
</html>
